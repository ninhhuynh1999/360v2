<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tham quan SGU 360&#186;</title>
    <script src="/js/jquery/jquery-3.6.0.min.js"></script>
    <script src="/js/jquery/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="/js/jquery/popper.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" crossorigin="anonymous">
    <script src="/bootstrap/js/bootstrap.min.js" crossorigin="anonymous"></script>

</head>

<body>
    <nav class="navbar navbar-expand-lg  navbar-dark bg-primary">
        <a class="navbar-brand" href="/">Tham quan SGU</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul style="font-weight: bold;" class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a style="font-weight: bold;" class="nav-link" href="/">Xem cảnh trường <span
                            class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="load360.html">Xem ảnh 360&#186; của bạn</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="viewmodels.html">Xem mô hình của trường</a>
                </li>
                <!-- <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Dropdown
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="#">Something else here</a>
              </div>
            </li> -->
                <!-- <li class="nav-item">
              <a class="nav-link disabled" href="#">Disabled</a>
            </li> -->
            </ul>
            <!-- <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form> -->
        </div>
    </nav>
    <!-- <div class="tooltip">Show info</div>
    <canvas id="output"></canvas> -->
    <div class="div-scene">
        <div class="main1">
            <div class="control-orbits">
                <div id="control-orbit-output">

                </div>
            </div>
            <div class="tooltip">Show info</div>
            <canvas style="max-width: 100%;max-height: 100%;" id="output"></canvas>
            <div class="map mini-map " id="map">
                <canvas style="max-width: 100%;max-height: 100%;" id="output-map">
                </canvas>
            </div>
            <div class="controls">
                <div class="chil-controls control-map" data-tooltip-number="0" onclick="clickMap()" data-status="open"
                    data-tooltip="Mở bản đồ">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>

                <div class="chil-controls thumb-control" data-tooltip-number="1" data-status="open"
                    onclick="clickThumb()" data-tooltip="Ẩn chọn cảnh">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>
                <div class="chil-controls rotate-control" data-tooltip-number="2" data-status="close"
                    onclick="clickRotate(this)" data-tooltip="Mở tự động xoay">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>

                <div class="chil-controls hidePoint-control" data-tooltip-number="4" data-status="open" onclick=""
                    data-tooltip="Ẩn các điểm chuyển cảnh">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>
                <div class="chil-controls help-control" data-tooltip-number="6" data-status="open"
                    onclick="clickHelp(this)" data-tooltip="Hướng dẫn">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>
                <div class="chil-controls fullscreen-control" data-tooltip-number="3" data-status="open"
                    onclick="clickFullscreen(this)" data-tooltip="Mở toàn màn hình">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>
                <div class="chil-controls hideAll-control" data-tooltip-number="5" data-status="open"
                    onclick="clickHide(this)" data-tooltip="Ẩn giao diện điều khiển">
                    <span class="tooltiptext-map">Tooltip text</span>
                </div>


            </div>

            <div class="mainThumb">
                <div class="search-thumb">

                    <input class="form-control mr-sm-2" class="input-search-thumb" type="search" placeholder="Tìm kiếm"
                        aria-label="Search" style="padding-top: 0px;padding-bottom: 0px;" oninput="searchThumb(this)">
                </div>
                <div class="bodyThumb">
                    <div class="list-thumb">
                        <div touch-action="none" class="div-list-thumb">
                            <div class="all-title">
                                <div class="div-title-thumb">
                                    <p class="p-title-thumb">
                                        111</p>
                                </div>
                            </div>
                            <div class="all-thumb">
                                <!-- <div class="div-thumb" elemtype="thumb">
                                <div class="div-thumb-img">
                                </div>
                            </div> -->

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slidecontainer">
                <div id="btn-zoom-out"></div>
                <input type="range" min="1" value="1" step="1" max="100" data-orientation="vertical" class="slider-zoom"
                    id="myRange">
                <div id="btn-zoom-in"></div>
            </div>

        </div>
    </div>
    <div class="div-help">
        <h4>Hướng dẫn sử dụng</h4>
        <h5>Điều khiển</h5>
        <ul>
            <li>Nhấn giữ chuột trái và di chuyển chuột để xoay</li>
            <li>Sử dụng con lăn chuột để phóng to và thu nhỏ</li>

        </ul>
        <h5>Chức năng</h5>
        <!-- <div class="div-img-help"></div> -->
        <img src="/images/help/help.png" alt="">
        <ol>
            <li>Cài đặt</li>
            <li>Danh sách các cảnh</li>
            <li>Các công cụ điều khiển</li>
            <li>Điểm chuyển cảnh (Nhấn vào để chuyển cảnh tiếp theo)</li>
            <li>Bản đồ: Xem vị trí hiện tại và có thể chọn các diểm trên đó để chuyển cảnh</li>
            <li>Thanh Phóng to/Thu nhỏ hình ảnh</li>
        </ol>
    </div>
    <script>
        var listThumb = document.querySelectorAll(".div-thumb")
        document.addEventListener("DOMContentLoaded", function (event) {
            listThumb = document.querySelectorAll(".div-thumb")
            document.querySelector(".slidecontainer").style.bottom = ((window.innerHeight * 0.02) + 65) + "px"
        });

        function clickMap() {
            var map = document.getElementById("map");
            if (isMobileDevice) {
                if (map.classList.contains("mini-map")) {
                    map.classList.remove("mini-map")
                    map.classList.add("activeMobile")
                } else {
                    map.classList.add('mini-map');
                    map.classList.remove("activeMobile")
                }
            } else {
                if (map.classList.contains("mini-map")) {
                    map.classList.remove("mini-map")
                    map.classList.add("active")
                } else {
                    map.classList.add('mini-map');
                    map.classList.remove("active")
                }
            }

        }
        function clickThumb() {
            var thumb = document.querySelector(".mainThumb");
            if (thumb.classList.contains("disableThumb")) {
                thumb.classList.remove("disableThumb")
            } else {
                thumb.classList.add('disableThumb');

            }
        }
        function clickRotate(e) {
            if (e.classList.contains("disableRotate")) {
                e.classList.remove("disableRotate")

            } else {
                e.classList.add('disableRotate');

            }

        }
        function clickFullscreen(e) {
            var elem = document.querySelector(".main1");
            if (e.getAttribute("data-status") == "open") {
                openFullscreen(elem);
            }
            if (e.getAttribute("data-status") == "close") {
                closeFullscreen(elem);
            }
        }
        function openFullscreen(elem) {
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
        }

        function closeFullscreen(elem) {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) { /* Safari */
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) { /* IE11 */
                document.msExitFullscreen();
            }
        }
        function clickHide(e) {
            if (e.getAttribute("data-status") == "open") {
                hideItems()
            } else {
                showItems()
            }

        }
        function hideItems() {
            var items = document.querySelectorAll(".chil-controls")
            var thumb = document.querySelector(".mainThumb")
            items.forEach(item => {
                if (item.classList.contains("hideAll-control")) return;
                item.style.display = "none"
            })

            thumb.style.visibility = "hidden"
            document.querySelector(".map").style.display = "none"
            document.querySelector(".slidecontainer").style.display = "none"

        }
        function showItems() {
            var items = document.querySelectorAll(".chil-controls")
            var thumb = document.querySelector(".mainThumb")

            items.forEach(item => {
                if (item.classList.contains("hideAll-control")) return;
                item.style.display = "inline-block"
            })


            thumb.style.visibility = "visible"

            document.querySelector(".map").style.display = "block"
            document.querySelector(".slidecontainer").style.display = "block"

        }
        function clickHelp() {
            document.querySelector(".div-help").scrollIntoView({ behavior: 'smooth' })
        }
        class Tooltip {
            /**
             * @param {String} open - tooltip text open
             * @param {String} close- tooltip text close
             * @param {String} imgOpen- link image open
             * @param {String} imgClose- link image close
            */
            constructor(open, close, imgOpen, imgClose) {
                this.open = open
                this.close = close
                this.imgOpen = imgOpen
                this.imgClose = imgClose
            }
        }
        const tooltips = [
            new Tooltip("Phóng to bản đồ", "Thu nhỏ bản đồ", "/images/icons/icon-map.png", "/images/icons/icon-map.png"),
            new Tooltip("Ẩn chọn cảnh", "Hiện chọn cảnh", "/images/icons/icon-details.png", "/images/icons/icon-details-disable.png"),
            new Tooltip("Đóng tự dộng xoay", "Mở tự dộng xoay", "/images/icons/icon-rotate-left.png", "/images/icons/icon-rotate-left-disable.png"),
            new Tooltip("Mở toàn màn hình", "Thoát toàn màn hình", "/images/icons/icon-fullscreen.png", "/images/icons/icon-fullscreen-disable.png"),
            new Tooltip("Ẩn điểm chuyển cảnh", "Hiện điểm chuyển cảnh", "images/icons/icon-point.png", "images/icons/icon-point-disable.png"),
            new Tooltip("Ẩn giao diện điều khiển", "Mở giao diện điều khiển", "images/icons/icon-arrow-right.png", "images/icons/icon-arrow-left.png"),
            new Tooltip("Hướng dẫn", "Hướng dẫn", "images/icons/icon-help.png", "images/icons/icon-help.png"),

        ]
        document.querySelectorAll(".chil-controls").forEach(x => {
            const div = x.firstElementChild
            //const tooltip = document.querySelector(".tooltiptext-map")
            const tooltip = div
            x.addEventListener("mouseover", function () {
                mouseOver(x, tooltip)
            })
            x.addEventListener("mouseleave", function () {
                mouseLeave(x, tooltip)
            })
            x.addEventListener("click", function () {
                mouseClick(x, tooltip)
            })
            x.addEventListener("touchstart", function (event) {
                //event.preventDefault()
                mouseOver(x, tooltip)
            })
            x.addEventListener("touchend", function () {
               //mouseClick(x, tooltip)
                mouseLeave(x, tooltip)
            })
            x.addEventListener("touchcancle",function(){
                mouseLeave(x, tooltip)
            })

        })
        document.addEventListener("fullscreenchange", function () {

            if (!document.fullscreenElement) {
                let x = document.querySelector(".fullscreen-control")
                var number = x.getAttribute("data-tooltip-number")
                x.setAttribute("data-tooltip", tooltips[number].open)
                x.setAttribute("data-status", "open")
                x.style.background = 'url("' + tooltips[number].imgOpen + '") no-repeat center center';
            }
        }, false)
        function mouseOver(x, tooltip) {
            tooltip.innerHTML = x.getAttribute("data-tooltip")
            var rect = x.getBoundingClientRect();
            var parent = document.querySelector(".controls").getBoundingClientRect()
            tooltip.style.left = (rect.left - parent.left + (rect.width / 2)) + 'px'
            tooltip.style.visibility = "visible"
        }
        function mouseLeave(x, tooltip) {

            tooltip.style.visibility = "hidden"
        }
        function mouseClick(x, tooltip) {
            var number = x.getAttribute("data-tooltip-number")
            //   tooltip.style.visibility = "hidden"
            if (x.getAttribute("data-status") == "open") {
                x.setAttribute("data-tooltip", tooltips[number].close)
                x.setAttribute("data-status", "close")
                x.style.background = 'url("' + tooltips[number].imgClose + '") no-repeat center center';
            } else {
                x.setAttribute("data-tooltip", tooltips[number].open)
                x.setAttribute("data-status", "open")
                x.style.background = 'url("' + tooltips[number].imgOpen + '") no-repeat center center';
            }
            tooltip.innerHTML = x.getAttribute("data-tooltip")
            if (isMobileDevice) {
                tooltip.style.visibility = "hidden"

            } else {
                tooltip.style.visibility = "visible"
            }

        }


        function searchThumb(e) {
            console.log(e)
            listThumb.forEach(thumb => {
                var name = thumb.getAttribute("data-name").toLowerCase()
                if (name.includes(e.value.toLowerCase())) {
                    thumb.style.display = "block"
                } else {
                    thumb.style.display = "none"
                }
            })
        }

        function isMobileDevice() {
            return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1);
        };

        $(document).ready(function () {
            const isMobile = isMobileDevice()
            if (isMobile) {
                const map = document.querySelector(".map")
                const thumb = document.querySelector(".mainThumb")
                const gui = document.querySelector("#gui")
                const controls = document.querySelector(".controls")
                controls.style.overfolow = "auto"
                gui.style.display = "none"
                map.style.left = "1%"
                map.style.top = "1%"
            }
        })
    </script>

</body>

</html>